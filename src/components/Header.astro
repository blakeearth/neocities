---
import HeaderLink from "./HeaderLink.astro";
import { SITE_TITLE } from "../consts";

const { hideGuestbook, targetParent } = Astro.props;
---

<header class="flex justify-between items-center md:items-end">
  <nav class="flex flex-wrap items-end gap-2 mb-2">
    <HeaderLink href="/" target=`${targetParent ? '_blank' : ''}`
      >{SITE_TITLE}</HeaderLink
    >
    <HeaderLink href="/cards" target=`${targetParent ? '_blank' : ''}`
      >cards</HeaderLink
    >
    <HeaderLink href="/library" target=`${targetParent ? '_blank' : ''}`
      >library</HeaderLink
    >
    <HeaderLink
      href="/links"
      target=`${targetParent ? '_blank' : ''}`
      class=`${hideGuestbook ? 'hidden' : ''}`>links</HeaderLink
    >
    <a
      class=`${hideGuestbook ? 'hidden' : ''}`
      target="_blank"
      href="https://drive.proton.me/urls/4Z6XRNNZ64#qIyCKpbs20KG">guestbook</a
    >
  </nav>
  <div class="mb-2">
    <a class="cursor-pointer" id="themeToggle" aria-label="Toggle theme">
      <span id="themeIcon">☀</span>
    </a>
  </div>
</header>

<script is:inline>
  (function () {
    const root = document.documentElement;
    const toggle = document.getElementById("themeToggle");
    const icon = document.getElementById("themeIcon");

    function applyTheme(theme) {
      if (theme === "dark") {
        root.classList.add("dark");
        icon.textContent = "☽";
      } else {
        root.classList.remove("dark");
        icon.textContent = "☀";
      }
    }

    const saved = localStorage.getItem("theme");
    if (saved) {
      applyTheme(saved);
    } else {
      // respect OS preference
      const prefersDark =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;
      applyTheme(prefersDark ? "dark" : "light");
    }

    toggle.addEventListener("click", function () {
      const isDark = root.classList.contains("dark");
      const next = isDark ? "light" : "dark";
      applyTheme(next);
      localStorage.setItem("theme", next);
    });
  })();
</script>
