---
import { getCollection } from "astro:content";
import Quote from "./Quote.astro";

const { highlightId, searchText } = Astro.props;

const books = await getCollection("books");
const highlights = await getCollection("highlights");

const highlightItem = searchText
  ? highlights.find((h: any) => h.data.text.includes(searchText))
  : highlights.find((h: { id: any }) => h.id === highlightId);
const highlight = highlightItem!.data;

const bookItem = books.find((b: { id: any }) => b.id === highlight.source);
const book = bookItem!.data;

const tags = highlight.tags
  .split(",")
  .filter((tag: string) => tag.length > 0)
  .map((tag: string) => tag.trim());
---

<Quote
  text={highlight.text}
  author={book.author}
  sourceTitle={book.title}
  sourceUrl={`/library/highlights/books/${highlight.source}`}
  date={highlight.timestamp}
  tags={tags}
  coverImageUrl={book?.coverImage?.medium}
  coverImageAlt={`Cover of ${book.title}`}
  coverImageLinkUrl={`/library/highlights/books/${highlight.source}`}
/>
